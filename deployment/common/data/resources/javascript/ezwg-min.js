function CEvent(){this.subscribers=new Array();CEvent.prototype.subscribe=function(a){if((a!=undefined)&&(this.subscribers.indexOf(a)==-1)){this.subscribers.push(a)}};CEvent.prototype.unsubscribe=function(b){for(var a in this.subscribers){if(this.subscribers[a]==b){this.subscribers.splice(a,1);break}}};CEvent.prototype.fire=function(a){for(var b=0;b<this.subscribers.length;b++){this.subscribers[b].call(a)}}}function CHashTable(){var b=this;this.len=0;this.items=new Array();for(var a=0;a<arguments.length;a+=2){if(typeof(arguments[a+1])!="undefined"){b.items[arguments[a]]=arguments[a+1];b.len++}}this.removeItem=function(c){if(typeof(b.items[c])!="undefined"){b.len--;delete b.items[c]}};this.addItem=function(c,d){if(typeof(d)!="undefined"&&typeof(b.items[c])=="undefined"){b.len++;b.items[c]=d;return d}else{return"undefined"}};this.getItem=function(c){return b.items[c]};this.hasItem=function(c){return typeof(b.items[c])!="undefined"};this.getLength=function(){return b.len}}function CPhoto(c,b){var a=this;this.nativeSize=b;this.size=TOOLS.clone(b);this.id=c;this.f_loaded=false;this.spinner=new Image();this.spinner.src="resources/images/ajax-loader.gif";this.image=new Image();CPhoto.prototype.load=function(d,e){if(this.f_loaded==false){$(this.image).load(function(){TOOLS.trace(this.src+" loaded.");a.f_loaded=true;e(a)}).attr("src",d)}};CPhoto.prototype.resize=function(e){var d=TOOLS.clone(this.nativeSize);if(e.w<this.nativeSize.w&&e.h<this.nativeSize.h){d=e}if(this.f_loaded==true){$(this.image).width(d.w).height(d.h)}else{}this.size=d};CPhoto.prototype.verticalCenter=function(d){$(this.getImage()).css("position","relative").verticalCenter(d)};CPhoto.prototype.getImage=function(){if(this.f_loaded==true){return this.image}else{return this.spinner}};CPhoto.prototype.isLoaded=function(){return this.f_loaded}}function CFifo(){var a=this;this.m_stack=new Array();this.m_length=0;this.push=function(b){a.m_stack[a.m_length]=b;a.m_length++};this.pushFirst=function(c){for(var b=a.m_length;b>0;b--){a.m_stack[b]=a.m_stack[b-1]}a.m_stack[0]=c;a.m_length++};this.pop=function(){var b;if(a.m_length>0){b=a.m_stack.shift();a.m_length--}else{b="undefined"}return b};this.size=function(){return a.m_length}}function CStorage(a){var c=this;this.nbItems=a;this.storage=new CHashTable();this.ages=new Array();for(var b=0;b<this.nbItems;b++){this.ages[b]=-1}this.addPhoto=function(d){if(c.storage.hasItem(d.url)==false){c.removeOldest();c.storage.addItem(d.url,new CPhoto(d.id,d.size));c.updateAges(d.url)}TOOLS.trace("Cache free space: "+(c.nbItems-c.storage.getLength()));return c.storage.getItem(d.url)};this.removeOldest=function(){if(c.storage.getLength()>=c.nbItems){var d=c.ages[c.nbItems-1];c.storage.removeItem(d);TOOLS.trace("removing "+d)}};this.updateAges=function(d){for(b=c.nbItems-1;b>0;b--){c.ages[b]=c.ages[b-1]}c.ages[0]=d};this.photoLoaded=function(d){c.storage.getItem(d).isLoaded=true}}function CUserInterractions(b,a){var e=this;this.html=a;this.properties=b;this.windowResizedEvent=new CEvent();this.thumbnailClickedEvent=new CEvent();this.closePhotoEvent=new CEvent();this.previousPhotoEvent=new CEvent();this.previousPhotoEvent=new CEvent();this.nextPhotoEvent=new CEvent();this.buttonEnabledClass="photoButtonEnabled";this.buttonDisabledClass="photoButtonDisabled";this.previousPhotoId=-1;this.currentPhotoId=1;this.nextPhotoId=2;this.fCurrentlyScrolling=false;this.fEnablePreviousNextRequired=false;var d=37;var f=39;var c=27;this.watchedKeyDown=false;this.start=function(){$(window).resize(function(){e.onWindowResized()});e.enableThumbnailClick();e.disablePreviousNext();if(!e.properties.photos.technical.rightClickEnabled){e.html.photo.$screen.bind("contextmenu",function(g){return false})}};this.disablePreviousNext=function(){e.disablePrevious();e.disableNext()};this.enablePreviousNext=function(){if(!e.fCurrentlyScrolling){e.enablePrevious();e.enableNext();e.fEnablePreviousNextRequired=false;e.html.photo.$current.data("hammer").options.prevent_default=true;e.html.photo.$current.data("hammer").options.swipe_velocity=0.7}else{e.fEnablePreviousNextRequired=true}};this.enablePrevious=function(){if(e.previousPhotoId>=1){TOOLS.trace("enable previous "+e.previousPhotoId);e.html.photo.buttons.$previous.removeClass().addClass(e.buttonEnabledClass).one("click",e.onPreviousPhoto);e.html.photo.$current.hammer().bind("swiperight",function(g){e.onPreviousPhoto()})}};this.disablePrevious=function(){TOOLS.trace("disable previous");e.html.photo.buttons.$previous.removeClass().addClass(e.buttonDisabledClass).unbind("click");e.html.photo.$current.hammer().unbind("swiperight")};this.enableNext=function(){if(e.nextPhotoId<=e.properties.photos.list.length){TOOLS.trace("enable next "+e.nextPhotoId);e.html.photo.buttons.$next.removeClass().addClass(e.buttonEnabledClass).one("click",e.onNextPhoto);e.html.photo.$current.hammer().bind("swipeleft",function(g){e.onNextPhoto()})}};this.disableNext=function(){TOOLS.trace("disable next");e.html.photo.buttons.$next.removeClass().addClass(e.buttonDisabledClass).unbind("click");e.html.photo.$current.hammer().unbind("swipeleft")};this.enableThumbnailClick=function(){e.html.index.mosaic.$thumbnails.click(function(){TOOLS.trace("thumbnail #"+this.id+" clicked.");e.thumbnailClickedEvent.fire(this)})};this.getWindowResizedEvent=function(){return e.windowResizedEvent};this.getThumbnailClickedEvent=function(){return e.thumbnailClickedEvent};this.getPreviousPhotoEvent=function(){return e.previousPhotoEvent};this.getNextPhotoEvent=function(){return e.nextPhotoEvent};this.onWindowResized=function(){e.windowResizedEvent.fire()};this.onPhotoDisplayedLoaded=function(g){e.previousPhotoId=g-1;e.nextPhotoId=g+1;e.currentPhotoId=g;e.enablePreviousNext()};this.onPreviousPhoto=function(){e.disablePrevious();e.previousPhotoEvent.fire({id:e.previousPhotoId})};this.onNextPhoto=function(){e.disableNext();e.nextPhotoEvent.fire({id:e.nextPhotoId})};this.onScrolling=function(){e.fCurrentlyScrolling=true};this.onScrolled=function(){e.fCurrentlyScrolling=false;if(e.fEnablePreviousNextRequired){e.fEnablePreviousNextRequired=false;e.enablePreviousNext()}};this.onIndexScreen=function(){$(window).unbind("keydown");e.html.photo.$screen.css("z-index",1);e.html.index.$screen.css("z-index",10);e.enableThumbnailClick()};this.onPhotoScreen=function(){$(window).unbind("keydown").keydown(function(g){e.onKeyboardPhotoScr(g)});e.html.index.mosaic.$thumbnails.unbind("click");e.html.index.$screen.css("z-index",1);e.html.photo.$screen.css("z-index",10)};this.onKeyboardPhotoScr=function(h){if(e.watchedKeyDown==false){var g=h.keyCode||h.which;switch(g){case d:e.watchedKeyDown=true;e.html.photo.buttons.$previous.click();e.watchedKeyDown=false;break;case f:e.watchedKeyDown=true;e.html.photo.buttons.$next.click();e.watchedKeyDown=false;break;case c:e.watchedKeyDown=true;e.html.toolbar.$buttonIndex.click();e.watchedKeyDown=false;break}}}}function CFrameFactory(b){var a=this;this.strPhoto="divPhoto";this.strFrame="cadrePhoto";this.strCaption="photoCaption";this.captions=[];for(i=0;i<b.length;i++){this.captions[i]=b[i].caption}this.frame=function(c,d){c.append('<div id="'+a.strFrame+'"><div id="'+a.strTitle+'"></div><div id="'+a.strPhoto+'"></div><div class="'+a.strCaption+'"></div></div>');a.caption(c.find(a.getStrCaption()),d)};this.caption=function(c,d){c.empty().append(a.captions[d])};this.getStrPhoto=function(){return"#"+a.strPhoto};this.getStrFrame=function(){return"#"+a.strFrame};this.getStrCaption=function(){return"."+a.strCaption}}function CCarrousel(a,b){var c=this;this.properties=a;this.html=b;this.html.photoClass="mainPhoto";this.html.$viewport=$("#photoViewport");this.html.$slides=$(".slide");this.html.$deprecated="NULL";this.html.$previous=$("#previousSlide");this.html.$next=$("#nextSlide");this.photoDisplayedLoadedEvent=new CEvent();this.scrollingEvent=new CEvent();this.scrolledEvent=new CEvent();this.loader=new CPhotoLoader(a,this.html);this.frameFactory=new CFrameFactory(a.photos.list);this.prevPhoto=-1;this.currPhoto=-1;this.nextPhoto=-1;this.displayPhoto=function(e,g){var d=g.find(c.frameFactory.getStrPhoto());d.find("img").remove();var f=e.getImage();$image=$(f);if(e.isLoaded()==true){$image.removeClass().addClass(c.html.photoClass)}d.append(f);d.width($image.outerWidth()).height($image.outerHeight());d.parent().width(d.outerWidth()).height(d.outerHeight()+d.siblings().outerHeight()).verticalCenter(0);TOOLS.trace("parent: "+$(c.frameFactory.getStrFrame()).width()+" - "+$(c.frameFactory.getStrFrame()).parent().height());TOOLS.trace("div: "+d.width()+" - "+d.height());TOOLS.trace("img: "+$image.width()+" - "+$image.height())};this.centerViewport=function(){c.html.$viewport.scrollLeft(c.html.$current.position().left)};this.previous=function(d){c.setCurrentPhoto(d);var e=c.loader.load(c.currPhoto,c.loader.PREVIOUS);c.currentPhoto=e;c.frameFactory.frame(c.html.$previous,d-1);c.displayPhoto(e,c.html.$previous);c.scroll(c.html.$previous);return e};this.load=function(e){c.setCurrentPhoto(e);var d=c.loader.load(e,c.loader.NEXT);c.displayPhoto(d,c.html.$current);c.frameFactory.caption(c.html.$caption,e-1);c.html.$viewport.scrollLeft(c.html.$current.position().left);c.currentPhoto=d;return d};this.next=function(d){c.setCurrentPhoto(d);var e=c.loader.load(c.currPhoto,c.loader.NEXT);c.currentPhoto=e;c.frameFactory.frame(c.html.$next,d-1);c.displayPhoto(e,c.html.$next);c.scroll(c.html.$next);return e};this.getCurrentPhoto=function(){return c.currentPhoto};this.setSpace=function(d){c.loader.setSpace(d)};this.updateHandles=function(){c.html.$deprecated=$(".deprecated");c.html.$previous=$("#previousSlide");c.html.$current=$("#currentSlide");c.html.$next=$("#nextSlide");c.html.$frame=c.html.$current.find(c.frameFactory.getStrFrame());c.html.$div=c.html.$frame.find(c.frameFactory.getStrPhoto());c.html.$caption=c.html.$frame.find(c.frameFactory.getStrCaption());c.html.$slides=$(".slide")};this.setCurrentPhoto=function(d){c.currPhoto=d;c.prevPhoto=d-1;c.nextPhoto=d+1};this.scroll=function(d){c.scrollingEvent.fire();c.html.$frame.addClass("deprecated");if(d==c.html.$previous){$("#slidesContainer").animate({left:"+="+c.html.$current.outerWidth()+"px"},"fast","swing",function(){c.onScrolled("BACKWARD")});c.html.$next.addClass("deprecated");c.html.$current.attr("id","nextSlide");c.html.$previous.attr("id","currentSlide")}else{$("#slidesContainer").animate({left:"-="+c.html.$current.outerWidth()+"px"},"fast","swing",function(){c.onScrolled("FORWARD")});c.html.$previous.addClass("deprecated");c.html.$current.attr("id","previousSlide");c.html.$next.attr("id","currentSlide")}c.updateHandles()};this.onPhotoLoaded=function(){if(this.id==c.currPhoto){c.displayPhoto(this,c.html.$current);c.photoDisplayedLoadedEvent.fire(this)}};this.loader.getPhotoLoadedEvent().subscribe(c.onPhotoLoaded);this.onScrolled=function(d){c.html.$deprecated.remove();if(d=="FORWARD"){$("#slidesContainer").css("left","0px");c.html.$current.parent().append('<div id="nextSlide" class="slide"></div>')}else{c.html.$current.parent().prepend('<div id="previousSlide" class="slide"></div>');$("#slidesContainer").css("left","0px")}c.updateHandles();c.scrolledEvent.fire()};this.getPhotoDisplayedLoadedEvent=function(){return c.photoDisplayedLoadedEvent};this.getScrollingEvent=function(){return c.scrollingEvent};this.getScrolledEvent=function(){return c.scrolledEvent}}function CPhotoStrategy(a){var b=this;this.properties=a;this.getDppx=function(){var c=1;if(!(navigator.userAgent.match(/(Phone)|(Mobile)/i)&&!navigator.userAgent.match(/(iPad)|(iPod)/i))){c=window.devicePixelRatio||Math.round(window.screen.availWidth/document.documentElement.clientWidth)||1}return c};this.getImage=function(d){var c=b.getImageStrategyFct(d);c.id=d;TOOLS.trace("space: "+b.spaceRealPx.w+" "+b.spaceRealPx.h+" / "+c.url);return c};this.setSpace=function(c){b.spaceRealPx.h=c.h*b.spaceRealPx.dppx;b.spaceRealPx.w=c.w*b.spaceRealPx.dppx};this.getBiggerImage=function(f){var c=false;var g=b.properties.photos.list[f-1].sizes;var h=new Object();$.each(g,function(k,j){if(Math.max(j.width,j.height)>=Math.max(b.spaceRealPx.w,b.spaceRealPx.h)){h[k]=j;c=true}});var e=Number.MAX_VALUE;var d=b.properties.photos.technical.largetSet;$.each(h,function(k,j){if(j.width<e){e=h[k].width;d=k}});return{url:b.properties.defines.IMAGES_PATH+"/"+d+"/"+b.properties.photos.list[f-1].filename,size:{w:g[d].width,h:g[d].height}}};this.getSmallerImage=function(e){var c=false;var g=b.properties.photos.list[e-1].sizes;var h=new Object();$.each(g,function(k,j){if(j.width<=b.spaceRealPx.w&&j.height<=b.spaceRealPx.h){h[k]=j;c=true}});var f=0;var d=b.properties.photos.technical.smallestSet;$.each(h,function(k,j){if(j.width>f){f=h[k].width;d=k}});return{url:b.properties.defines.IMAGES_PATH+"/"+d+"/"+b.properties.photos.list[e-1].filename,size:{w:g[d].width,h:g[d].height}}};this.getImageStrategyStr={0:b.getSmallerImage,1:b.getBiggerImage};this.getImageStrategyFct=this.getImageStrategyStr[this.properties.photos.technical.qualityStrategy];this.spaceRealPx={h:0,w:0,dppx:this.getDppx()}}function CPhotoLoader(a,b){var c=this;this.NEXT=1;this.PREVIOUS=-1;this.properties=a;this.html=b;this.strategy=new CPhotoStrategy(a);this.$spinner=$(new Image());this.$spinner.attr("src",this.html.spinnerSrc);this.storage=new CStorage(a.photos.technical.cacheSize);this.prefetchingQueue=new CFifo();this.photoLoadedEvent=new CEvent();this.fetch=function(f){TOOLS.trace("Fetching "+f);var e=c.strategy.getImage(f);var d=c.storage.addPhoto(e);if(d.isLoaded()==false){d.load(e.url,function(g){c.photoLoadedEvent.fire(g);if(c.prefetchingQueue.size()>0){c.fetch(c.prefetchingQueue.pop())}})}else{if(c.prefetchingQueue.size()>0){c.fetch(c.prefetchingQueue.pop())}}return d};this.load=function(g,f){for(var d=c.properties.photos.technical.prefetchSize;d>0;d--){var e=g+(f*d);if(e<=c.properties.photos.list.length&&e>0){c.prefetchingQueue.pushFirst(e)}}return c.fetch(g)};this.setSpace=function(d){c.strategy.setSpace(d)};this.getPhotoLoadedEvent=function(){return c.photoLoadedEvent}}function CUrl(c){var b=this;this.photoStr="Photo";this.photoList=c;this.setHash=function(d){window.location.hash=b.photoStr+d};this.clearHash=function(){window.location.hash=""};this.display=function(f){var e=window.location.hash;var d=parseInt(e.substring(e.indexOf(b.photoStr)+b.photoStr.length));if(a(d)&&d<=b.photoList.length){f(d)}else{}};function a(d){return !isNaN(parseInt(d))&&isFinite(d)}}function CNavBars(a){var b=this;this.html=a;this.html.photo.buttons.$nav=$.merge($(".photoButtonEnabled"),$(".photoButtonDisabled"));var c=setTimeout(function(){b.hide()},250);$("#photoViewport").mousemove(function(){clearTimeout(b.timer);b.show();b.timer=setTimeout(function(){b.hide()},250)});b.html.photo.buttons.$nav.mouseenter(function(){clearTimeout(b.timer)});this.show=function(){b.html.photo.$navBars.fadeIn(10).css("z-index","50");b.html.photo.buttons.$nav.verticalCenter(0)};this.hide=function(){b.html.photo.$navBars.stop().fadeOut(1000,function(){$(this).css("z-index","-10")})}}function CMap(){var a=this;this.isDisplayed=false;this.display=function(){if(a.isDisplayed===false){var b={center:{lat:9.6257333,lng:-84.010995},zoom:8};var d=new google.maps.Map(document.getElementById("wrapper_map_costarica"),b);var c=new google.maps.KmlLayer({url:"http://voyages.pixinn.net/costarica/maps/costarica.kml"});c.setMap(d);a.isDisplayed=true}}}function CDeck(){var a=this;this.storage=new Array();this.add=function(b){a.storage.push(b)};this.getTop=function(){return a.storage[a.storage.length-1]};this.moveOnTop=function(c){var b=a.storage.indexOf(c);if(b!==-1){var d=a.storage.length-1;oldScrTop=a.storage[d];a.storage[d]=a.storage[b];a.storage[b]=oldScrTop}};this.removeFromTop=function(){if(a.storage>1){var b=a.storage.length-1;oldScrTop=a.storage[b];a.storage[b]=a.storage[b-1];a.storage[b-1]=oldScrTop}}}function CScreen(a){var b=this;b.$handle=a.$handle;b.deck=a.deck;b.listButtonsOther=a.listButtonsOther;b.buttonScreen=a.buttonScreen;this.eventOnDisplaying=new CEvent();this.eventOnDisplayed=new CEvent();this.eventOnHiding=new CEvent();this.eventOnHidden=new CEvent();this.display=function(){if(b.buttonScreen!=="undefined"){b.buttonScreen.disable()}b.$handle.css("z-index","100").fadeIn("fast",function(){for(var c=0;c<b.listButtonsOther.length;c++){if(typeof b.listButtonsOther[c]!=="undefined"){b.listButtonsOther[c].enable()}}scr=b.deck.getTop();scr.hide();b.deck.moveOnTop(b);b.eventOnDisplayed.fire()});b.eventOnDisplaying.fire()};this.hide=function(){b.eventOnHiding.fire();b.$handle.css("z-index","-1").hide();b.eventOnHidden.fire()}}function CButtonToolbar(a){var b=this;b.$handle=a.$handle;b.onClick=a.onClick;if(typeof a.script!=="undefined"&&a.script.indexOf("//")!=-1){b.script=a.script;b.isLocked=true}else{b.script="undefined";b.isLocked=false}this.enable=function(){if(!b.isLocked){b.$handle.css("opacity","1").css("cursor","pointer").unbind().click(b.onClick)}};this.disable=function(){b.$handle.css("opacity","0.4").css("cursor","not-allowed").unbind()};if(b.script!="undefined"){$.getScript(b.script,function(){b.isLocked=false;b.enable()})}b.$handle.show();this.enable()}function CDisplay(a,b){var c=this;this.html=b;this.html.photo.spinnerSrc="resources/images/ajax-loader.gif";this.properties=a;this.carrousel=new CCarrousel(a,this.html.photo);this.navBars=new CNavBars(b);this.url=new CUrl(a.photos.list);this.idCurrentPhoto=-1;this.photoScreenEvent=new CEvent();this.indexScreenEvent=new CEvent();this.disableUISignal=new CEvent();this.enableUISignal=new CEvent();this.displayedPhotoLoadedEvent=new CEvent();this.availableSpace={h:0,w:0};$(".display_optional").hide();this.deck=new CDeck();this.toolbar=Toolbar(b);c.deck.moveOnTop(c.toolbar.screenIndex);c.toolbar.screenPhoto.eventOnHiding.subscribe(function(){c.hidePhoto()});$(window).resize(function(){TOOLS.trace("Evt resize");c.setSpace(c.computeAvailableSpace());if(c.html.photo.$screen.is(":visible")===true){c.fitPhoto(c.carrousel.getCurrentPhoto());c.carrousel.centerViewport()}});this.displayCurrentUrl=function(){c.url.display(c.displayPhoto)};this.displayPhoto=function(d){c.idCurrentPhoto=d;c.toolbar.screenPhoto.display();c.html.photo.buttons.$next.verticalCenter(c.computeToolbarTopHeigth()/2);c.html.photo.buttons.$previous.css("top",c.html.photo.buttons.$next.css("top"));c.setSpace(c.computeAvailableSpace());c.load(d,c.carrousel.load);c.photoScreenEvent.fire()};this.hidePhoto=function(){TOOLS.trace("hidePhoto");var d=c.html.index.mosaic.$thumbBoxes.eq(c.idCurrentPhoto-1);c.indexScreenEvent.fire(d)};this.getPhotoDisplayedLoadedEvent=function(){return c.displayedPhotoLoadedEvent};this.getPhotoScreenEvent=function(){return c.photoScreenEvent};this.getIndexScreenEvent=function(){return c.indexScreenEvent};this.getDisableUISignal=function(){return c.disableUISignal};this.getEnableUISignal=function(){return c.enableUISignal};this.getScrollingEvent=function(){return c.carrousel.getScrollingEvent()};this.getScrolledEvent=function(){return c.carrousel.getScrolledEvent()};this.onPrevious=function(){c.idCurrentPhoto--;c.load(c.idCurrentPhoto,c.carrousel.previous)};this.onNext=function(){c.idCurrentPhoto++;c.load(c.idCurrentPhoto,c.carrousel.next)};this.onPhotoDisplayedLoaded=function(){c.displayedPhotoLoadedEvent.fire(this);c.fitPhoto(this)};c.carrousel.getPhotoDisplayedLoadedEvent().subscribe(this.onPhotoDisplayedLoaded);this.setSpace=function(e){var d={};d.h=e.h-c.computeToolbarTopHeigth();d.w=e.w;c.availableSpace=d;c.carrousel.setSpace(d)};this.load=function(f,e){c.disableUISignal.fire();var d=e(f);if(d.isLoaded()==true){c.displayedPhotoLoadedEvent.fire(d)}c.fitPhoto(d)};this.computeAvailableSpace=function(){var l=6;var f=33;var k=33;var e=0;for(var g=0;g<c.html.photo.$wrapper.siblings().length;g++){}var j=parseInt(c.html.photo.$frame.css("padding-top").replace("px",""));var d=c.html.photo.$wrapper.innerHeight()-2*j-2*c.properties.photos.technical.decoration.padding-f;var h=c.html.photo.$wrapper.innerWidth()-e-2*j-2*c.properties.photos.technical.decoration.padding-l;return{h:d,w:h}};this.fitPhoto=function(d){var f=d.nativeSize.h/d.nativeSize.w;var e={};if(f>1){e.h=c.availableSpace.h;e.w=Math.round(e.h/f);if(e.w>c.availableSpace.w){e.w=c.availableSpace.w;e.h=Math.round(e.w*f)}}else{e.w=c.availableSpace.w;e.h=Math.round(e.w*f);if(e.h>c.availableSpace.h){e.h=c.availableSpace.h;e.w=Math.round(e.h/f)}}var g=c.computeToolbarTopHeigth()/2;d.resize(e);c.html.photo.$div.width(d.size.w+2*c.properties.photos.technical.decoration.padding).height(d.size.h+2*c.properties.photos.technical.decoration.padding);c.html.photo.$frame.width(c.html.photo.$div.outerWidth()).height(c.html.photo.$div.outerHeight()+c.html.photo.$caption.outerHeight()).css("position","relative").verticalCenter(g);d.verticalCenter(0)};this.computeToolbarTopHeigth=function(){var d=$(".toolbar").filter(":visible").outerHeight();if(d>$(document).height()/2){d=0}TOOLS.trace("Toolbar up space: "+d+"px");return d}}CScroller=function(b){this.options=b;var a=this;this.options.$navigation.css("cursor","pointer").click(function(){var d=$(this).attr("target");var c=a.options.$viewport.find(d);a.scrollTo($(this),c)});CScroller.prototype.scrollTo=function(d,c){a.options.$viewport.animate({scrollLeft:c.position().left},a.options.duration,a.options.easing,function(){a.options.onAfter(d,c)})};CScroller.prototype.scrollToPageNr=function(e,g){var d=a.options.$navigation.eq(e-1);var f=a.options.$navigation.eq(g-1).attr("target");var c=a.options.$viewport.find(f);a.scrollTo(d,c)}};CProgressBar=function(a){var b=this;this.options=a;this.nbThumbnailsLoaded=0;CProgressBar.prototype.onLoad=function(){b.nbThumbnailsLoaded++;b.options.$progessBar.reportprogress(b.nbThumbnailsLoaded,b.options.nbThumbnails)};CProgressBar.prototype.show=function(){b.options.$screen.show();b.options.$progessBar.parent().verticalCenter(0)};CProgressBar.prototype.hide=function(){b.options.$screen.hide()}};function CMosaic(a,b){this.html=b;this.buildHtml=function(){var d="thumbBox";c.htmlStructure.index.mosaic.$handle.hide();for(var f=1;f<=c.mosaicNbThumbnails;f++){c.htmlStructure.index.mosaic.$handle.append('<div class="'+d+'" id="'+f+'"></div>')}var e=$("."+d);c.htmlStructure.index.mosaic.$thumbBoxes=e;c.thumbnailsSet=c.computeThumbnailsSet();c.ThumbnailSize=c.properties.index.mosaic.sizes[c.thumbnailsSet];e.each(function(h){var g=c.properties.photos.list[h].filename;var j=new Image();$(this).append(j);$(j).load(function(){c.oneThumbLoadedEvent.fire(this)}).attr("id",this.id).attr("src",src=c.properties.defines.URL_THUMBS_PATH+"/"+c.thumbnailsSet+"/"+g)});return c.htmlStructure};this.onThumbnailLoaded=function(){if(++c.nbThumbnailLoaded==c.mosaicNbThumbnails){c.allThumbsLoadedEvent.fire()}};this.onThumbnailsLoaded=function(){var d=c.htmlStructure.index.mosaic.$thumbBoxes;var g=d.find("img");var e=g.first().css("border-top-width");e=e.replace("px","");c.htmlStructure.index.mosaic.$handle.show();d.width(c.ThumbnailSize+2*e).height(c.ThumbnailSize+2*e);var h=c.properties.index.mosaic.nbCols*d.outerWidth();var f=Math.ceil(c.mosaicNbThumbnails/c.properties.index.mosaic.nbCols)*d.outerHeight()+c.htmlStructure.index.mosaic.$title.outerHeight(true);c.htmlStructure.index.mosaic.$thumbnails=g;c.htmlStructure.index.mosaic.$handle.width(h).height(f)};this.show=function(d){c.htmlStructure.index.mosaic.$thumbnails.verticalCenter(0);if(typeof d!="undefined"){c.center(d)}};this.hide=function(){c.htmlStructure.index.mosaic.$handle.hide()};this.center=function(d){var e=c.html.index.mosaic.$thumbBoxes.eq(0);var f=d.offset().top-e.offset().top;c.html.index.mosaic.$wrapper.scrollTop(f);TOOLS.trace("scrollAmount: "+f)};this.getLoadingEvent=function(){return c.oneThumbLoadedEvent};this.getLoadedEvent=function(){return c.allThumbsLoadedEvent};this.computeThumbnailsSet=function(){var f=false;var e=c.properties.index.mosaic.defaultSet;var d=c.htmlStructure.index.mosaic.$wrapper.innerWidth()*0.95;$.each(c.properties.index.mosaic.sizes,function(h,g){if(!f&&d>c.properties.index.mosaic.nbCols*(g+2*c.properties.index.mosaic.decoration.borderBox+2*c.properties.index.mosaic.decoration.borderPhoto)){e=h;f=true}});return e};var c=this;this.properties=a;this.htmlStructure=b;this.scroller;this.mosaicSizeMargin=100;this.mosaicNbThumbnails=c.properties.photos.list.length;this.mosaicNbThumbsByPanels=(c.properties.index.mosaic.nbRows*c.properties.index.mosaic.nbCols);this.mosaicNbPanels=Math.ceil(c.mosaicNbThumbnails/c.mosaicNbThumbsByPanels);this.nbThumbnailLoaded=0;this.ThumbnailSize=0;this.currentPageNr=1;this.oneThumbLoadedEvent=new CEvent();this.oneThumbLoadedEvent.subscribe(this.onThumbnailLoaded);this.allThumbsLoadedEvent=new CEvent();this.allThumbsLoadedEvent.subscribe(this.onThumbnailsLoaded)}Defines={URL_THUMBS_PATH:"thumbnails",IMAGES_PATH:"images",};TOOLS={trace:function(b){if(window.console){var a=new Date();console.log(a.getTime()+": "+b)}},clone:function(b){var a={};jQuery.extend(a,b);return a},debug:function(a){$("#DEBUG").append(a).show()},};jQuery.fn.verticalCenter=function(a){return this.each(function(){var d=jQuery(this);var b=d.parent();if(d.is(":visible")&&b.is(":visible")){var c;c=(b.innerHeight()-d.outerHeight())/2-a;c=Math.max(c,0);d.css("top",c)}else{TOOLS.trace("Vertical center: object or its parent not visible!")}})};jQuery.fn.fit=function(a){return this.each(function(){var c=jQuery(this);var b=c.width()/c.height();c.width(a).height(a/b)})};$(document).ajaxError(function(){TOOLS.trace("Error ajax: "+$(this).attr("src"))});$(document).ready(function(){g_properties.defines=Defines;HtmlStructure={$window:$(window),progressBar:{$screen:$("#screenProgress"),$box:$("#progressbarWrapper"),$bar:$("#progressbar")},toolbar:{$buttonShare:$(".button_share"),$buttonIndex:$(".button_browse")},share:{$screen:$("#screenShare"),$wrapper:$("#wrapper_share"),$buttons:$(".addtoany_button")},index:{$screen:$("#screenIndex"),mosaic:{$wrapper:$("#wrapper_mosaic"),$handle:$("#mosaic"),$title:$("#indexTitle")}},photo:{$screen:$("#screenPhoto"),$current:$("#currentSlide"),$frame:$("#cadrePhoto"),$wrapper:$("#wrapperAffichagePhoto"),$div:$("#divPhoto"),$caption:$(".photoCaption"),$navBars:$.merge($("#photoLefter"),$("#photoRighter")),buttons:{$previous:$("#boutonPrevious"),$next:$("#boutonNext"),$close:$("#screenPhoto").find(".button_browse")}}};HtmlStructure.index.$screen.find(".button_browse").css("opacity","0.4").css("filter","alpha(opacity=40)");Mosaic=new CMosaic(g_properties,HtmlStructure);progressBar=new CProgressBar({$screen:$("#screenPogress"),$progessBar:HtmlStructure.progressBar.$bar,nbThumbnails:g_properties.photos.list.length});Mosaic.getLoadingEvent().subscribe(progressBar.onLoad);Mosaic.getLoadedEvent().subscribe(function(){progressBar.hide();Mosaic.show();Mosaic.getLoadingEvent().unsubscribe(progressBar.onLoad());HtmlStructure.progressBar.$screen.remove();delete HtmlStructure.progressBar.$screen});var b=new CDisplay(g_properties,HtmlStructure);var a;Mosaic.getLoadedEvent().subscribe(function(){a=new CUserInterractions(g_properties,HtmlStructure);a.start();b.getPhotoDisplayedLoadedEvent().subscribe(function(){a.onPhotoDisplayedLoaded(this.id)});b.getPhotoScreenEvent().subscribe(a.onPhotoScreen);b.getIndexScreenEvent().subscribe(function(){Mosaic.show(this)});b.getIndexScreenEvent().subscribe(a.onIndexScreen);b.getDisableUISignal().subscribe(a.disablePreviousNext);b.getEnableUISignal().subscribe(a.enablePreviousNext);b.getScrollingEvent().subscribe(a.onScrolling);b.getScrolledEvent().subscribe(a.onScrolled);a.getWindowResizedEvent().subscribe(Mosaic.onResize);a.getThumbnailClickedEvent().subscribe(function(){b.displayPhoto(parseInt(this.id))});a.getPreviousPhotoEvent().subscribe(b.onPrevious);a.getNextPhotoEvent().subscribe(b.onNext);b.displayCurrentUrl()});progressBar.show();HtmlStructure=Mosaic.buildHtml()});