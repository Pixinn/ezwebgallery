var g_watchedKeyDown=false;function ButtonDeactivable(d,b){var e=d;var a=b;var c=false;this.enable=function(){e.css("cursor","pointer").removeClass("photoButtonDisabled").addClass("photoButtonEnabled").click(a);c=true};this.disable=function(){e.unbind("click").css("cursor","not-allowed").removeClass("photoButtonEnabled").addClass("photoButtonDisabled");c=false}}function onClickNext(){var b=g_idCurrentIndexPage;if(g_displayManager.fControlsDisabled===false&&g_idCurrentPhoto<g_nbPhotos){g_idCurrentPhoto++;g_idCurrentIndexPage=Math.ceil(g_idCurrentPhoto/(g_properties.index.mosaic.nbRows*g_properties.index.mosaic.nbCols));g_idPhotoToLoadNext=g_idCurrentPhoto;if(g_idCurrentIndexPage!==b){g_$buttonsIndexNavigation.eq(g_idCurrentIndexPage-1).click()}for(var a=0;a<=g_properties.photos.technical.prefetchSize;a++){g_loadQueue.insert(g_idCurrentPhoto+a,a)}g_displayManager.photoToDisplay=g_idCurrentPhoto;loadingManagement("NEXT")}}function onClickPrevious(){var b=g_idCurrentIndexPage;if(g_displayManager.fControlsDisabled===false&&g_idCurrentPhoto>g_properties.photos.technical.first){g_idCurrentPhoto--;g_idCurrentIndexPage=Math.ceil(g_idCurrentPhoto/(g_properties.index.mosaic.nbRows*g_properties.index.mosaic.nbCols));g_idPhotoToLoadNext=g_idCurrentPhoto;if(g_idCurrentIndexPage!==b){g_$buttonsIndexNavigation.eq(g_idCurrentIndexPage-1).click()}for(var a=0;a<=g_properties.photos.technical.prefetchSize;a++){g_loadQueue.insert(g_idCurrentPhoto-a,a)}g_displayManager.photoToDisplay=g_idCurrentPhoto;loadingManagement("PREVIOUS")}}function onClickReturnToIndex(){g_displayManager.hideScreenPhoto()}function imageEvents(){var b=37;var c=39;var a=27;g_buttonNextPhoto=new ButtonDeactivable($(BUTTON_NEXTPHOTONAME),onClickNext);g_buttonPreviousPhoto=new ButtonDeactivable($(BUTTON_PREVIOUSPHOTONAME),onClickPrevious);$(BUTTON_RETURNTOINDEXNAME).click(onClickReturnToIndex);if(!g_properties.photos.technical.rightClickEnabled){g_$divDisplayZoneName.bind("contextmenu",function(d){return false})}$(window).keydown(function(e){var f=false;if(g_watchedKeyDown===false&&g_displayManager.screenPhotoIsDisplayed()===true){var d=e.keyCode||e.which;switch(d){case b:g_watchedKeyDown=true;onClickPrevious();f=true;break;case c:g_watchedKeyDown=true;onClickNext();f=true;break;case a:g_watchedKeyDown=true;onClickReturnToIndex();f=true;break}}return !f});$(window).keyup(function(e){var d=e.keyCode||e.which;switch(d){case b:case c:case a:g_watchedKeyDown=false;break}})}function loadingManagement(a){var b;var c;var e;var d;g_idPhotoToLoadNext=g_loadQueue.pop();c=g_displayManager.getMaxSize();if(g_idPhotoToLoadNext!="undefined"&&g_idPhotoToLoadNext>=1&&g_idPhotoToLoadNext<=g_nbThumbnails){d=choosePhotoToLoad(c,g_idPhotoToLoadNext);e=g_prefetchManager.getTargetedSize(g_idPhotoToLoadNext);switch(a){case"NEXT":case"PREVIOUS":case"THUMBNAIL":if(g_prefetchManager.isPhotoLoaded(g_idCurrentPhoto)===false||(e!=="undefined"&&((e.h<d.size.h||(e.w)<d.size.w)))){g_displayManager.displayLoading()}break;case"AUTO":break;default:break}if(g_prefetchManager.hasPhoto(g_idPhotoToLoadNext)===false){photoURL=d.url;b=g_prefetchManager.addPhoto(g_idPhotoToLoadNext,d.size,g_displayManager.photoToDisplay);if(b!="undefined"){b.load(function(){var g;g_prefetchManager.loadingFinished(this);g=g_displayManager.displayPhoto($(this),g_prefetchManager);loadingManagement("AUTO")}).error(function(){$(this).attr("src","ressources/images/errorPhoto.gif");if(window.console){dbgTrace("Erreur de chargement photo #"+g_idPhotoToLoadNext)}}).attr("src",src=photoURL)}}else{if(g_prefetchManager.isPhotoLoaded(g_idPhotoToLoadNext)==true){if(e!=="undefined"&&((e.h)<d.size.h||(e.w)<d.size.w)){g_prefetchManager.delPhoto(g_idPhotoToLoadNext);g_loadQueue.insert(g_idPhotoToLoadNext,0);loadingManagement("AUTO")}else{var f;b=g_prefetchManager.getPhoto(g_idPhotoToLoadNext);f=g_displayManager.displayPhoto(b,g_prefetchManager);loadingManagement("AUTO")}}}}delete b;delete c}function choosePhotoToLoad(c,b){var a=new Object();if(g_properties.photos.technical.qualityStrategy===0){a=getSmallerImage(c,b)}else{a=getBiggerImage(c,b)}return{url:a.url,size:a.size}}function getBiggerImage(f,d){var a=false;var e=g_properties.photos.list[d-1].sizes;var g=new Object();$.each(e,function(i,h){if(h.width>=f.w||h.height>=f.h){g[i]=h;a=true}});var c=Number.MAX_VALUE;var b=g_properties.photos.technical.largestSet;$.each(g,function(i,h){if(h.width<c){c=g[i].width;b=i}});return{url:IMAGES_PATH+"/"+b+"/"+g_properties.photos.list[d-1].filename,size:{w:e[b].width,h:e[b].height}}}function getSmallerImage(f,c){var a=false;var e=g_properties.photos.list[c-1].sizes;var g=new Object();$.each(e,function(i,h){if(h.width<=f.w&&h.height<=f.h){g[i]=h;a=true}});var d=0;var b=g_properties.photos.technical.smallestSet;$.each(g,function(i,h){if(h.width>d){d=g[i].width;b=i}});return{url:IMAGES_PATH+"/"+b+"/"+g_properties.photos.list[c-1].filename,size:{w:e[b].width,h:e[b].height}}};