var URL_BASE="ressources/php/getPhoto.php?photoURL=";var URL_THUMBS_PATH="thumbnails/";var IMAGES_PATH="images";var IMAGEFILEEXTENSION=".jpg";var DIV_PROGRESSBARWRAPPER="#progressbarWrapper";var DIV_PROGRESSBARNAME="#progressbar";var DIV_SCREENPHOTO="#screenPhoto";var DIV_PHOTONAME="#cadrePhoto";var CLASS_LEGEND="photoCaption";var DIV_DISPLAYZONENAME="#wrapperAffichagePhoto";var CLASS_MAINPHOTO="mainPhoto";var BUTTON_NEXTPHOTONAME="#boutonNext";var BUTTON_PREVIOUSPHOTONAME="#boutonPrevious";var BUTTON_RETURNTOINDEXNAME="#boutonIndex";var CLASS_SPINNER="Spinner";var AJAX_TIMEOUT_VALUE=30000;var DIV_SCREENINDEX="#screenIndex";var DIV_INDEXDISPLAYZONE="#wrapperAffichageIndex";var DIV_NAVIGATIONINDEX_CONTAINER="ul.indexNavigation";var CLASSNAVIGATIONTABSELECTED="navTabSelected";var DIV_INDEX_CONTAINER="#indexSliderContainer";var DIV_THUMBSWRAPPER=".thumbsWrapper";var DIV_SCROLLCONTAINER=".scrollContainer";var DIV_SLIDINGPANEL=".slidingPanel";var DIV_THUMBCONTAINER=".thumbBox";var ID_INDEXPREFIX="index";var g_loadQueue;var g_prefetchManager;var g_displayManager;var g_idCurrentPhoto;var g_idPhotoToLoadNext;var g_idCurrentIndexPage;var g_nbRes;var g_nbPhotos;var g_pixelsOccupesEnHaut;var g_pixelsOccupesEnBas;var g_listeThumbnails;var g_nbThumbFullyLoaded;var g_nbThumbnails;var g_buttonNextPhoto;var g_buttonPreviousPhoto;var g_buttonReturnToIndex;var g_$divScrollContainer;var g_$divSlidingPanels;var g_$screenPhoto;var g_$divCadrePhotoName;var g_$divDisplayZoneName;var g_$screenIndex;var g_$buttonsIndexNavigation;var g_$divIndexContainer;var g_$divThumbsWrapper;var g_$divThumbBox;var g_$divScrollContainer;var g_$divSlidingPanel;var g_thumbSize;var g_idWaitForThumbs;function ajaxError(a,b,c){if(window.console){console.log("Ajax error: "+b)}}$(document).ready(function(){$(DIV_PROGRESSBARWRAPPER).css("display","block").css("top",($(window).height()-$(DIV_PROGRESSBARWRAPPER).outerHeight())/2).css("left",($(window).width()-266)/2);$.ajaxSetup({timeout:AJAX_TIMEOUT_VALUE,cache:false,error:ajaxError});$(document).ajaxError(function(c,b,a){if(window.console&&window.console.error){console.error("Error requesting page:"+a.url)}});initGallery()});function initGallery(){g_nbThumbFullyLoaded=0;g_nbThumbnails=0;g_nbRes=0;var l;var j;var k;var m=g_properties.index.mosaic.nbRows*g_properties.index.mosaic.nbCols;g_listeThumbnails=new Array;g_nbThumbnails=g_properties.photos.list.length;g_nbRes=g_properties.photos.list[0].sizes.length;g_nbPhotos=g_nbThumbnails;l=Math.ceil(g_nbThumbnails/m);for(var g=0;g<g_properties.photos.list.length;g++){var a=g_properties.photos.list[g];g_listeThumbnails[a.filename]=g+1}for(g=0;g<l;g++){j=g+1;$(DIV_SCROLLCONTAINER).append('<div class="'+DIV_SLIDINGPANEL.substr(1,DIV_SLIDINGPANEL.length-1)+'" id="'+ID_INDEXPREFIX+j+'"></div>');if(l>1){$(DIV_NAVIGATIONINDEX_CONTAINER).append('<li><a href="#'+ID_INDEXPREFIX+j+'" id="'+j+'">'+j+"</a></li>")}}$(DIV_NAVIGATIONINDEX_CONTAINER).find("#"+1).parent().addClass(CLASSNAVIGATIONTABSELECTED);var h=false;var d=g_properties.index.mosaic.defaultSet;g_thumbSize=g_properties.index.mosaic.sizes[d];var f=100;var n=$("#screenIndex").width()-g_properties.index.mosaic.unavailable.horizontal-f/2;var c=$("#screenIndex").height()-g_properties.index.mosaic.unavailable.vertical-f;$.each(g_properties.index.mosaic.sizes,function(o,i){if(!h&&(n>i*g_properties.index.mosaic.nbCols)&&(c>i*g_properties.index.mosaic.nbRows)){d=o;g_thumbSize=i;h=true}});var b=$(DIV_SLIDINGPANEL);var e;var k=1;for(e=0;e<b.length;e++){var g=1;while((g<=m)&&(k<=g_nbThumbnails)){$(DIV_SLIDINGPANEL).eq(e).append('<div class="'+DIV_THUMBCONTAINER.substr(1,DIV_THUMBCONTAINER.length-1)+'" id="'+k+'"></div>');k++;g++}}$(DIV_THUMBCONTAINER).each(function(o){var i=g_properties.photos.list[o].filename;var p=new Image();$(this).append(p);$(p).load(function(){g_nbThumbFullyLoaded++;$(DIV_PROGRESSBARNAME).reportprogress(g_nbThumbFullyLoaded,g_nbThumbnails)}).error(function(){dbgTrace("common.js / Erreur de chargement thumbnail "+g_nbThumbFullyLoaded++)}).attr("src",src=URL_THUMBS_PATH+d+"/"+i)});g_idWaitForThumbs=window.setInterval(initGallery_step2_waitForThumbs,500);g_$screenPhoto=$(DIV_SCREENPHOTO);g_$divCadrePhotoName=$(DIV_PHOTONAME);g_$divDisplayZoneName=$(DIV_DISPLAYZONENAME);g_$divScrollContainer=$(DIV_SCROLLCONTAINER);g_$divSlidingPanels=$(DIV_SLIDINGPANEL);g_$divThumbsWrapper=$(DIV_THUMBSWRAPPER).css("overflow","hidden");g_$screenIndex=$(DIV_SCREENINDEX);g_$buttonsIndexNavigation=$(DIV_NAVIGATIONINDEX_CONTAINER+" a");g_$divIndexContainer=$(DIV_INDEX_CONTAINER);g_$divThumbBox=$(DIV_THUMBCONTAINER);g_idCurrentPhoto=g_properties.photos.technical.first;g_idCurrentIndexPage=g_properties.index.mosaic.first;g_pixelsOccupesEnHaut=33;g_pixelsOccupesEnBas=33;g_displayManager=new DisplayManager(g_$screenPhoto,g_$divCadrePhotoName,$(BUTTON_NEXTPHOTONAME),$(BUTTON_PREVIOUSPHOTONAME),$(BUTTON_RETURNTOINDEXNAME),CLASS_MAINPHOTO,CLASS_LEGEND,CLASS_SPINNER,0,g_pixelsOccupesEnHaut,g_pixelsOccupesEnBas,g_properties.photos.technical.maxSize.width,g_properties.photos.technical.maxSize.height);g_prefetchManager=new TablePhotos(g_properties.photos.technical.cacheSize);g_loadQueue=new Fifo()}function initGallery_step2_waitForThumbs(){if(g_nbThumbFullyLoaded>=g_nbThumbnails){clearInterval(g_idWaitForThumbs);initGallery_step3()}}function initGallery_step3(){var b=$(".thumbBox img").first().css("border-top-width");b=b.substr(0,b.indexOf("px",0));$(".thumbBox").width(g_thumbSize+2*b).height(g_thumbSize+2*b);var g=g_properties.index.mosaic.nbCols*$(".thumbBox").outerWidth();var c=g_properties.index.mosaic.nbRows*$(".thumbBox").outerHeight();var f=$(".thumbsWrapperContainer");var a=f.css("border-left-width");a=a.substr(0,a.indexOf("px",0));$("#indexSliderContainer").width(g+2*a);f.width(g).height(c);$(".thumbsWrapper").width(g).height(c);$(".scrollContainer").find(".slidingPanel").width(g).height(c);$(DIV_PROGRESSBARWRAPPER).hide();g_$divIndexContainer.show().verticalCenter(0);$(DIV_THUMBCONTAINER+" img").verticalCenter(0);indexEvents();imageEvents();$(window).resize(function(){onWindowResize()});var d=true;if(d===true){g_$divSlidingPanels.css({"float":"left",position:"relative"});g_$divScrollContainer.css("width",g_$divSlidingPanels[0].offsetWidth*g_$divSlidingPanels.length)}var e={target:g_$divThumbsWrapper,margin:true,items:g_$divSlidingPanels,navigation:".indexNavigation a",axis:"xy",duration:500,easing:"swing",onAfter:triggedAfterScroll};$.localScroll(e);if(window.location.hash){triggedAfterScroll({id:window.location.hash.substr(1)})}else{g_$buttonsIndexNavigation.eq(0).click()}}function highlightNav(){g_$buttonsIndexNavigation.each(function(){$(this).parent().removeClass(CLASSNAVIGATIONTABSELECTED)});$(this).parent().addClass(CLASSNAVIGATIONTABSELECTED)}function triggedAfterScroll(b){var a=$(DIV_NAVIGATIONINDEX_CONTAINER).find('a[href$="'+b.id+'"]').get(0);highlightNav.call(a)}function onThumbLoaded(a){g_nbThumbFullyLoaded++;$(DIV_PROGRESSBARNAME).reportprogress(g_nbThumbFullyLoaded,g_nbThumbnails)}function s_Taille(){var b;var a}function onWindowResize(){g_$divIndexContainer.verticalCenter(0);if(g_$divDisplayZoneName.is(":visible")===true){var a=g_prefetchManager.getPhoto(g_idCurrentPhoto);g_displayManager.adjustPhoto(a);$(BUTTON_PREVIOUSPHOTONAME).verticalCenter(0);$(BUTTON_NEXTPHOTONAME).verticalCenter(0)}}jQuery.fn.verticalCenter=function(a){return this.each(function(){var b;b=(jQuery(this).parent().height()-jQuery(this).outerHeight()-2*a)/2;b=Math.max(b,0);jQuery(this).css("top",b)})};jQuery.fn.horizontalCenter=function(){return this.each(function(){var a;a=(jQuery(this).parent().innerWidth()-jQuery(this).outerWidth())/2;jQuery(this).css("margin-left",a)})};jQuery.fn.windowCenter=function(){return this.each(function(){var b;var a;b=(jQuery(window).width()-jQuery(this).outerWidth())/2;a=(jQuery(window).height()-jQuery(this).outerHeight())/2;jQuery(this).css("left",b).css("top",a)})};function calculerTaillesMax(g,d,a,h,j){var b=6;var k;var f=new s_Taille();var e=0;var c;for(c=0;c<g_$divDisplayZoneName.siblings().length;c++){e+=g_$divDisplayZoneName.siblings().eq(c).outerWidth()}divCadrePhotoBorderSize=a.css("padding-top");divCadrePhotoBorderSize=divCadrePhotoBorderSize.substr(0,divCadrePhotoBorderSize.indexOf("px",0));f.h=g_$divDisplayZoneName.innerHeight()-2*divCadrePhotoBorderSize-2*g_properties.photos.technical.decoration.padding-g-d;f.w=$(window).width()-e-2*divCadrePhotoBorderSize-2*g_properties.photos.technical.decoration.padding-b;if(f.h>j){f.h=j}if(f.w>h){f.w=h}return f}function dbgTrace(a){if(window.console){console.log(a)}};